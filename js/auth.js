var ref=new Firebase("https://enduserscoinflip.firebaseio.com/");var path=window.location.pathname;var page=path.split("/").pop();var authprovider="";var old_email;ref.onAuth(function(a){var c=window.location.pathname;var b=c.split("/").pop();if(a){if(a.provider=="password"){old_email=ref.getAuth().password.email;authprovider="password"}else{if(a.provider=="facebook"){authprovider="Facebook"}else{authprovider="Google"}}if(b=="index.html"||b=="register.html"||b=="login.html"){window.location="wire2.html"}}else{if(b!="index.html"&&b!="register.html"&&b!="login.html"){window.location="index.html"}}});function authFacebook(){ref.authWithOAuthPopup("facebook",function(a,b){if(a){console.log("Login Failed!",a)}else{console.log("Authenticated successfully with payload:",b)}})}function authGoogle(){ref.authWithOAuthPopup("google",function(a,b){if(a){console.log("Login Failed!",a)}else{console.log("Authenticated successfully with payload:",b)}})}function createUser(){var b=document.getElementById("regemail").value;var a=document.getElementById("regpassword").value;mixpanel.track("Register",{User:b});ref.createUser({email:b,password:a},function(c,d){if(c){document.getElementById("alert").innerHTML=c}else{document.getElementById("alert").innerHTML="Successfully registered with the email address: "+b+'!<br><a href="login.html">Click here to log in.<svg class="icon icon-play-arrow"> <symbol id="icon-play-arrow2" viewBox="0 0 1024 1024"><title>play-arrow</title>                                 <path class="path1" d="M341.333 213.333v597.333l469.333-298.667z"></path>                                </symbol>                                <use xlink:href="#icon-play-arrow2"></use>   </svg></a>';document.getElementById("register-div").style.display="none"}})}function loginUser(){var b=document.getElementById("regemail").value;var a=document.getElementById("regpassword").value;ref.authWithPassword({email:b,password:a},function(c,d){if(c){document.getElementById("alert").innerHTML=c}else{document.getElementById("alert").innerHTML="Log in successful!";document.getElementById("register-div").style.display="none";mixpanel.track("Log in",{User:b});window.location="wire2.html"}})}function pressEnter(a){if(event.keyCode==13){if(a=="register"){createUser()}else{if(a=="login"){loginUser()}else{if(a=="additem"){}}}}}function updateEmail(){var b=document.getElementById("e_user_email").value;var a=document.getElementById("e_user_password").value;ref.changeEmail({oldEmail:old_email,newEmail:b,password:a},function(c){if(c===null){document.getElementById("e_update_alert").innerHTML="Success!";old_email=b;console.log("Email changed successfully")}else{document.getElementById("e_update_alert").innerHTML=c;console.log("Error changing email:",c)}})}function updatePassword(){var a=document.getElementById("p_user_password").value;var b=document.getElementById("p_user_new_password").value;ref.changePassword({email:old_email,oldPassword:a,newPassword:b},function(c){if(c===null){document.getElementById("p_update_alert").innerHTML="Success!";console.log("Password changed successfully")}else{document.getElementById("p_update_alert").innerHTML=c;console.log("Error changing password:",c)}})}function saveToStack(){var d=ref.getAuth();if(d){var i=window.location.href.indexOf("#");var g=(i>0)?window.location.href.slice(i+1):"";var c=document.getElementById("form_metal").value;var f=document.getElementById("form_type");var a=f.options[f.selectedIndex].text;var h=document.getElementById("form_purchase_date").value;var j=document.getElementById("form_quantity").value;var e=document.getElementById("form_premium").value;var b=document.getElementById("form_unit_price").value;if(!h){alert("Please enter a purchase date!")}else{if(!j){alert("Please enter a quantity!")}else{if(!e){alert("Please enter a premium!")}else{if(!b){alert("Please enter a unit price!")}else{mixpanel.track("Save to Stack",{User:d.uid,Metal:c,Type:a,"Purchase Date":h,Quantity:j,Premium:e,"Unit Price":b});ref.child("users").child(d.uid).push({img_hash:g,metal:c,type:a,purchase_date:h,quantity:j,premium:e,unit_price:b,percent:"0.999",weight_unit_g:"1.244",gu:"1.244",ozt_u:"0.0400",total_au:"0.0400",total:j*b*0.999+parseInt(e)});if(c=="gold"){window.location="wire3.html"}else{if(c=="silver"){window.location="wire6.html"}else{if(c=="platinum"){window.location="wire7.html"}}}}}}}}}window.onload=function(){if(page=="wire4.html"){var a=window.location.hash.substr(1);var b=ref.getAuth();qref=ref.child("users");qref.child(b.uid).child(a).once("value",function(c){var d=new Firebase(ref+"/pano/"+c.val().img_hash+"/filePayload");d.once("value",function(e){var f=e.val();if(f!=null){document.getElementById("img_circle").style.display="none";document.getElementById("img_box").style.backgroundImage="url('"+f+"')"}});document.getElementById("td_metal").innerHTML=c.val().metal.charAt(0).toUpperCase()+c.val().metal.substring(1);document.getElementById("td_type").innerHTML=c.val().type;document.getElementById("td_purchase_date").innerHTML=c.val().purchase_date;document.getElementById("td_quantity").innerHTML=c.val().quantity;document.getElementById("td_premium").innerHTML=c.val().premium;document.getElementById("td_unit_price").innerHTML=c.val().unit_price;document.getElementById("td_percent").innerHTML=c.val().percent;document.getElementById("td_weight_unit_g").innerHTML=c.val().weight_unit_g;document.getElementById("td_gu").innerHTML=c.val().gu;document.getElementById("td_ozt_u").innerHTML=c.val().ozt_u;document.getElementById("td_total_au").innerHTML=c.val().total_au;document.getElementById("td_total").innerHTML=c.val().total},function(c){console.log("The read failed: "+c.code)})}else{if(page=="wire2.html"||page=="wire3.html"||page=="wire6.html"||page=="wire7.html"){var b=ref.getAuth();qref=ref.child("users");qref.child(b.uid).once("value",function(c){var d=0;c.forEach(function(k){var m=k.val();if((page=="wire3.html"&&m.metal=="gold")||(page=="wire6.html"&&m.metal=="silver")||(page=="wire7.html"&&m.metal=="platinum")){var g=document.getElementById("metal_table").getElementsByTagName("tbody")[0];var p=g.insertRow(-1);p.setAttribute("id",k.key());var e=p.insertCell(-1);e.setAttribute("class","stack_img_col");var o=p.insertCell(-1);var n=p.insertCell(-1);var h=p.insertCell(-1);var j=p.insertCell(-1);var l=p.insertCell(-1);var i=new Firebase(ref+"/pano/"+m.img_hash+"/filePayload");i.once("value",function(f){var q=f.val();if(q!=null){e.innerHTML='<div class="coin_mini" style="background-image:url('+q+');background-size:100% 100%;"></div>'}else{e.innerHTML='<div class="coin_mini"></div>'}});e.innerHTML='<div class="coin_mini"></div>';o.innerHTML=m.type;n.innerHTML=m.quantity;h.innerHTML=m.weight_unit_g;j.innerHTML=m.percent;l.innerHTML=m.total;p.setAttribute("onclick","window.document.location='wire4.html#"+k.key()+"'");d+=+m.total}else{if(page=="wire2.html"){d+=+m.total}}});d=parseFloat(d).toFixed(2);document.getElementById("totalvalue").innerHTML="$"+d},function(c){console.log("The read failed: "+c.code)})}}};if(page=="wire5.html"){var spinner=new Spinner({color:"#ddd"});var firebaseRef="https://enduserscoinflip.firebaseio.com/";function handleFileSelect(b){var c=b.target.files[0];var a=new FileReader();a.onload=(function(d){return function(j){var g=j.target.result;var i=CryptoJS.SHA256(Math.random()+CryptoJS.SHA256(g));var h=new Firebase(firebaseRef+"pano/"+i+"/filePayload");spinner.spin(document.getElementById("spin"));h.set(g,function(){spinner.stop();console.log(j.target.result);document.getElementById("img_circle").style.display="none";document.getElementById("img_box").style.backgroundImage="url('"+j.target.result+"')";window.location.hash=i})}})(c);a.readAsDataURL(c)}$(function(){$("#spin").append(spinner);var a=window.location.href.indexOf("#");var c=(a>0)?window.location.href.slice(a+1):"";if(c===""){document.getElementById("file-upload").addEventListener("change",handleFileSelect,false)}else{spinner.spin(document.getElementById("spin"));var b=new Firebase(firebaseRef+"/pano/"+c+"/filePayload");b.once("value",function(d){var e=d.val();if(e!=null){document.getElementById("img_circle").style.display="none";document.getElementById("img_box").style.backgroundImage="url('"+e+"')"}else{$("#body").append("Not found")}spinner.stop()})}})};
